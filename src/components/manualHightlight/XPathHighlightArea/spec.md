## 📘 アプリケーション概要

この React コンポーネントは、**固定 HTML 文書に対してユーザーがマウスで選択した範囲に赤い下線を引くハイライト機能**を提供します。ハイライトは、**XPath + テキストオフセット形式**で永続的に保存可能であり、DOM 構造をまたいだ選択やタグ間選択にも対応します。

---

## 🔧 機能一覧

| 機能カテゴリ       | 内容                                                                             |
| ------------------ | -------------------------------------------------------------------------------- |
| **範囲ハイライト** | ユーザーが文字列をマウスで選択すると、自動で赤い下線が引かれます。               |
| **範囲保存**       | 選択範囲を XPath + offset で構成される形式でメモリ上に保存します。               |
| **範囲再現**       | ページ再描画時や state 更新時に、保存された情報から正確に Range を復元し再描画。 |
| **下線一覧表示**   | 選択済み範囲のテキスト、XPath 情報、タイムスタンプをモーダルで一覧表示可能。     |
| **範囲削除**       | 個別にハイライトを削除可能。すべて一括削除も対応。                               |

---

## ⚠ 制限事項・注意点

| 制限項目                 | 内容                                                                                |
| ------------------------ | ----------------------------------------------------------------------------------- |
| **編集不可な HTML 対象** | `dangerouslySetInnerHTML`で描画された HTML が対象。ユーザーによる編集はできません。 |
| **リロード非対応**       | 保存は React の`useState`によるため、**リロードでハイライト情報は失われます**。     |
| **DOM 依存**             | XPath は DOM 構造に依存するため、構造が変化すると復元に失敗します。                 |
| **重複選択の統合なし**   | 範囲が重複しても統合はされず、重ねて表示されます。                                  |

---

## 🛠 利用技術スタック

| 技術                  | 内容                                                                       |
| --------------------- | -------------------------------------------------------------------------- |
| **React**             | UI 構築・コンポーネント管理                                                |
| **TypeScript**        | 型安全な開発                                                               |
| **Material UI (MUI)** | UI パーツ（ボタン、ダイアログ、テーブル等）                                |
| **DOM API**           | `Selection`, `Range`, `XPathEvaluator` を用いたブラウザ標準 API による処理 |

---

## 🧠 保存形式の構成

保存される選択範囲は、次のような構造で記録されます：

```ts
type SavedRange = {
  id: number;
  order: number;
  startXPath: string; // 開始位置のXPath (例: ./p[2]/text()[1])
  startOffset: number; // 開始文字オフセット
  endXPath: string; // 終了位置のXPath
  endOffset: number; // 終了文字オフセット
  text: string; // 選択された文字列
  timestamp: string; // 作成日時
};
```

---

## 📈 想定用途

- 学術論文・技術文書の校正・レビュー
- 教材上での任意ハイライト・注釈操作
- Kindle ライクな読書体験のプロトタイプ

---
